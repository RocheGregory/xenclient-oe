diff --git a/grub-core/normal/menu.c b/grub-core/normal/menu.c
index 9065cbe..9c2efa1 100644
--- a/grub-core/normal/menu.c
+++ b/grub-core/normal/menu.c
@@ -497,6 +497,17 @@ run_menu (grub_menu_t menu, int nested, int *auto_boot)
   grub_uint64_t saved_time;
   int default_entry, current_entry;
   int timeout;
+  char *tmp;
+  int edit_and_shell = 0;
+
+  tmp = grub_env_get("edit_and_shell");
+  if (tmp &&
+      (!grub_strcmp(tmp, "1") ||
+       !grub_strcmp(tmp, "true") ||
+       !grub_strcmp(tmp, "yes")))
+  {
+    edit_and_shell = 1;
+  }
 
   default_entry = get_entry_number (menu, "default");
 
@@ -633,18 +644,24 @@ run_menu (grub_menu_t menu, int nested, int *auto_boot)
 	      break;
 
 	    case 'c':
-	      menu_fini ();
-	      grub_cmdline_run (1);
-	      goto refresh;
+	      if (edit_and_shell)
+	        {
+	          menu_fini ();
+	          grub_cmdline_run (1);
+	          goto refresh;
+	        }
+	      break;
 
 	    case 'e':
-	      menu_fini ();
-		{
-		  grub_menu_entry_t e = grub_menu_get_entry (menu, current_entry);
-		  if (e)
-		    grub_menu_entry_run (e);
-		}
+	      if (edit_and_shell)
+	        {
+	          grub_menu_entry_t e;
+	          menu_fini ();
+	          if ((e = grub_menu_get_entry (menu, current_entry)))
+	            grub_menu_entry_run (e);
+	        }
 	      goto refresh;
+              break;
 
 	    default:
 	      {
